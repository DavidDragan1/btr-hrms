{"version":3,"file":"server-error.interceptor.js","sourceRoot":"","sources":["../../../../../../../packages/desktop-ui-lib/src/lib/interceptors/server-error.interceptor.ts"],"names":[],"mappings":";;;;AAAA,wCAA2C;AAS3C,+BAAiE;AACjE,6EAAwE;AACxE,0CAAoC;AACpC,mDAAuD;AAGhD,IAAM,sBAAsB,oCAA5B,MAAM,sBAAsB;IAClC,YACkB,oBAAyC,EACzC,gBAAiC,EACjC,MAAa;QAFb,yBAAoB,GAApB,oBAAoB,CAAqB;QACzC,qBAAgB,GAAhB,gBAAgB,CAAiB;QACjC,WAAM,GAAN,MAAM,CAAO;IAC3B,CAAC;IACL,SAAS,CACR,OAAyB,EACzB,IAAiB;QAEjB,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAC/B,IAAA,YAAK,EAAC,CAAC,CAAC,EACR,IAAA,iBAAU,EAAC,CAAC,KAAwB,EAAE,EAAE,CACvC,IAAA,iBAAU,EAAC,GAAG,EAAE;YACf,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE;gBAC3B,IACC,KAAK,CAAC,MAAM,gDAAsC;oBAClD,KAAK,CAAC,MAAM,oCAA0B,EACrC;oBACD,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;oBAC7B,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,IAAI,CACrC,aAAa,CACb,CAAC;iBACF;gBACD,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;aAC7C;YACD,OAAO,KAAK,CAAC;QACd,CAAC,CAAC,CACF,CACD,CAAC;IACH,CAAC;CACD,CAAA;iCA/BY,sBAAsB;IADlC,IAAA,iBAAU,GAAE;6CAG4B,2CAAmB;QACvB,0BAAe;QACzB,gBAAK;GAJnB,sBAAsB,CA+BlC","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport {\r\n\tHttpRequest,\r\n\tHttpHandler,\r\n\tHttpEvent,\r\n\tHttpInterceptor,\r\n\tHttpErrorResponse,\r\n\tHttpStatusCode\r\n} from '@angular/common/http';\r\nimport { Observable, catchError, retry, throwError } from 'rxjs';\r\nimport { ErrorHandlerService } from '../services/error-handler.service';\r\nimport { Store } from '../services';\r\nimport { ElectronService } from '../electron/services';\r\n\r\n@Injectable()\r\nexport class ServerErrorInterceptor implements HttpInterceptor {\r\n\tconstructor(\r\n\t\tprivate readonly _errorHandlerService: ErrorHandlerService,\r\n\t\tprivate readonly _electronService: ElectronService,\r\n\t\tprivate readonly _store: Store\r\n\t) { }\r\n\tintercept(\r\n\t\trequest: HttpRequest<any>,\r\n\t\tnext: HttpHandler\r\n\t): Observable<HttpEvent<any>> {\r\n\t\treturn next.handle(request).pipe(\r\n\t\t\tretry(1),\r\n\t\t\tcatchError((error: HttpErrorResponse) =>\r\n\t\t\t\tthrowError(() => {\r\n\t\t\t\t\tif (!this._store.isOffline) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\terror.status >= HttpStatusCode.InternalServerError ||\r\n\t\t\t\t\t\t\terror.status < HttpStatusCode.Continue\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tthis._store.isOffline = true;\r\n\t\t\t\t\t\t\tthis._electronService.ipcRenderer.send(\r\n\t\t\t\t\t\t\t\t'server-down'\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._errorHandlerService.handleError(error);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n}\r\n"]}