{"version":3,"file":"image-viewer.component.js","sourceRoot":"","sources":["../../../../../../../packages/desktop-ui-lib/src/lib/image-viewer/image-viewer.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n\tComponent,\r\n\tOnInit,\r\n\tViewChild,\r\n\tElementRef,\r\n\tNgZone,\r\n} from '@angular/core';\r\nimport { transition, trigger, style, animate } from '@angular/animations';\r\nimport { ElectronService } from '../electron/services';\r\nimport { SafeUrl } from '@angular/platform-browser';\r\nimport { ImageViewerService } from './image-viewer.service';\r\nimport { from } from 'rxjs';\r\nimport { NbIconLibraries } from '@nebular/theme';\r\n\r\nexport const fadeInOutAnimation = trigger('fadeInOut', [\r\n\ttransition(':enter', [\r\n\t\t// :enter is alias to 'void => *'\r\n\t\tstyle({ opacity: 0 }),\r\n\t\tanimate(300, style({ opacity: 1 })),\r\n\t]),\r\n\ttransition(':leave', [\r\n\t\t// :leave is alias to '* => void'\r\n\t\tanimate(300, style({ opacity: 0 })),\r\n\t]),\r\n]);\r\n\r\n@Component({\r\n\tselector: 'ngx-image-viewer',\r\n\ttemplateUrl: './image-viewer.component.html',\r\n\tstyleUrls: ['./image-viewer.component.scss'],\r\n\tanimations: [fadeInOutAnimation],\r\n})\r\nexport class ImageViewerComponent implements OnInit {\r\n\tactive_index: any;\r\n\r\n\t@ViewChild('customScroll', { static: true })\r\n\tcustomScroll: ElementRef<HTMLElement>;\r\n\r\n\titems = [];\r\n\r\n\titem: any = {};\r\n\tconstructor(\r\n\t\t// private dialogRef: NbDialogRef<any>\r\n\t\tprivate readonly _electronService: ElectronService,\r\n\t\tprivate readonly _ngZone: NgZone,\r\n\t\tprivate readonly _imageViewerService: ImageViewerService,\r\n\t\tprivate readonly _iconLibraries: NbIconLibraries\r\n\t) {\r\n\t\tthis._iconLibraries.registerFontPack('font-awesome', {\r\n\t\t\tpackClass: 'fas',\r\n\t\t\ticonClassPrefix: 'fa'\r\n\t\t});\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t\tthis._electronService.ipcRenderer.on(\r\n\t\t\t'show_image',\r\n\t\t\t(event, arg: any[]) => {\r\n\t\t\t\tthis._ngZone.run(() => {\r\n\t\t\t\t\tthis.items = arg\r\n\t\t\t\t\t\t.sort((a, b) => {\r\n\t\t\t\t\t\t\tconst c: any = new Date(b.recordedAt);\r\n\t\t\t\t\t\t\tconst d: any = new Date(a.recordedAt);\r\n\t\t\t\t\t\t\treturn c - d;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.map((img) => ({\r\n\t\t\t\t\t\t\t...img,\r\n\t\t\t\t\t\t\tfullUrl: from(this.sanitizeImgUrl(img.fullUrl)),\r\n\t\t\t\t\t\t\tthumbUrl: from(this.sanitizeImgUrl(img.thumbUrl)),\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\tthis.item = this.items[0];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t\tthis.active_index = 0;\r\n\t}\r\n\r\n\tclose() {\r\n\t\t// this.dialogRef.close();\r\n\t\tthis._electronService.ipcRenderer.send('close_image_view');\r\n\t}\r\n\r\n\tnext($event) {\r\n\t\t$event.stopPropagation();\r\n\t\tthis.active_index = Math.min(\r\n\t\t\tthis.active_index + 1,\r\n\t\t\tthis.items.length - 1\r\n\t\t);\r\n\t\tthis.item = this.items[this.active_index];\r\n\t\tthis.updateActiveIndex();\r\n\t}\r\n\r\n\tprev($event) {\r\n\t\t$event.stopPropagation();\r\n\t\tthis.active_index = Math.max(this.active_index - 1, 0);\r\n\t\tthis.item = this.items[this.active_index];\r\n\t\tthis.updateActiveIndex();\r\n\t}\r\n\r\n\tsetFocus(selectedItem) {\r\n\t\tconst foundItem = this.items.find((item) => item === selectedItem);\r\n\t\tif (this.item) {\r\n\t\t\tconst index = this.items.indexOf(this.item);\r\n\t\t\tthis.active_index = index;\r\n\t\t\tthis.item = foundItem;\r\n\t\t} else {\r\n\t\t\tthis.item = selectedItem;\r\n\t\t}\r\n\t\tthis.updateActiveIndex();\r\n\t}\r\n\r\n\tupdateActiveIndex() {\r\n\t\tconst activeItem =\r\n\t\t\tthis.customScroll.nativeElement.querySelector('.thumb-item-active');\r\n\t\tif (activeItem) {\r\n\t\t\tconst position = activeItem.getBoundingClientRect();\r\n\t\t\tif (position) {\r\n\t\t\t\tconst left: any = position.left;\r\n\t\t\t\tconst right: any = position.left + activeItem.clientWidth;\r\n\t\t\t\tconst scrollRight: any =\r\n\t\t\t\t\tthis.customScroll.nativeElement.clientWidth;\r\n\t\t\t\tconst scrollLeft: any =\r\n\t\t\t\t\tthis.customScroll.nativeElement.scrollLeft;\r\n\r\n\t\t\t\tif (left < Math.abs(scrollLeft) || right > scrollRight) {\r\n\t\t\t\t\tthis.customScroll.nativeElement.scrollTo({\r\n\t\t\t\t\t\tleft: left,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async sanitizeImgUrl(img: string): Promise<SafeUrl> {\r\n\t\treturn await this._imageViewerService.sanitizeImgUrl(img);\r\n\t}\r\n\r\n\tpublic trackById(index: number, item: any): number {\r\n\t\treturn item.id;\r\n\t}\r\n}\r\n"]}