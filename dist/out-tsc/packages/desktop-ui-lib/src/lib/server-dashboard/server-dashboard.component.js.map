{"version":3,"file":"server-dashboard.component.js","sourceRoot":"","sources":["../../../../../../../packages/desktop-ui-lib/src/lib/server-dashboard/server-dashboard.component.ts"],"names":[],"mappings":";;;;AAAA,wCAUuB;AACvB,gEAA0E;AAE1E,yDAAqE;AACrE,8CAAuD;AACvD,+BAAiC;AACjC,4CAAyC;AACzC,mDAAuD;AACvD,qFAAgF;AAEhF,IAAY,YAGX;AAHD,WAAY,YAAY;IACvB,uCAAuB,CAAA;IACvB,qCAAqB,CAAA;AACtB,CAAC,EAHW,YAAY,4BAAZ,YAAY,QAGvB;AASM,IAAM,wBAAwB,sCAA9B,MAAM,wBAAwB;IAoBpC,YACS,eAAgC,EAChC,IAAuB,EACvB,wBAAiD,EACjD,iBAAmC,EACnC,OAAe,EAEvB,YAAkC,EACjB,aAA2B;QAPpC,oBAAe,GAAf,eAAe,CAAiB;QAChC,SAAI,GAAJ,IAAI,CAAmB;QACvB,6BAAwB,GAAxB,wBAAwB,CAAyB;QACjD,sBAAiB,GAAjB,iBAAiB,CAAkB;QACnC,YAAO,GAAP,OAAO,CAAQ;QAEN,iBAAY,GAAZ,YAAY,CAAK;QACjB,kBAAa,GAAb,aAAa,CAAc;QAxB7C,cAAS,GAAoB,sCAAsC,CAAC;QACpE,YAAO,GAAG,KAAK,CAAC;QAChB,YAAO,GAAG,KAAK,CAAC;QAChB,YAAO,GAAG,KAAK,CAAC;QAChB,QAAG,GAAQ;YACV,IAAI,EAAE,YAAY,CAAC,KAAK;YACxB,IAAI,EAAE,qBAAqB;SAC3B,CAAC;QACF,gBAAW,GAAQ,EAAE,CAAC;QACtB,mBAAc,GAAG,KAAK,CAAC;QACvB,cAAS,GAAG,KAAK,CAAC;QAClB,WAAM,GAAG;YACR,QAAQ,EAAE,cAAc;YACxB,IAAI,EAAE,mBAAmB;SACzB,CAAC;QAYD,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YACnE,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YACrB,IAAI,CAAC,GAAG,GAAG;gBACV,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK;gBAClD,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,qBAAqB;aACzD,CAAC;YACF,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;YACnB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC;YACxC,IAAG,IAAI,CAAC,OAAO,EAAE;gBAChB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;aACrB;YACD,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YAC/D,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,EAAE,EAAE;gBACjC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;aAC/B;iBAAM;gBACN,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;gBACzB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;aAC/B;YACD,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YAC1B,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YAC9D,IAAI,CAAC,OAAO,GAAG,GAAG,EAAE,IAAI,KAAK,SAAS,CAAC;YACvC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC;YAC1C,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YACnE,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;YACnB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACnC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACvD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,YAAY,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,aAAa,CAAC;YACjC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,8BAA8B,CACjE,IAAI,CAAC,YAAY,CAAC,aAAa,CAC/B,CAAC;IACH,CAAC;IACD,eAAe;QACd,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAClC,iBAAiB,EACjB,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YACd,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE;gBACrB,IAAI,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,SAAS,IAAI,IAAI,EAAE;oBACrC,IAAI,CAAC,SAAS,EAAE,CAAC;iBACjB;YACF,CAAC,CAAC,CAAC;QACJ,CAAC,CACD,CAAC;QACF,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,CAClC,2BAA2B,EAC3B,CAAC,KAAK,EAAE,QAAuB,EAAE,EAAE;YAClC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE;gBACrB,IAAI,CAAC,wBAAwB,CAAC,WAAW,CACxC,QAAQ,EACR,IAAI,CAAC,iBAAiB,CACtB,CAAC;gBACF,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YAC3B,CAAC,CAAC,CAAC;QACJ,CAAC,CACD,CAAC;QACF,IAAA,WAAI,EAAC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;aACjE,IAAI,CACJ,IAAA,UAAG,EAAC,CAAC,QAAQ,EAAE,EAAE;YAChB,IAAI,CAAC,wBAAwB,CAAC,WAAW,CACxC,QAAQ,EACR,IAAI,CAAC,iBAAiB,CACtB,CAAC;YACF,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,CAAC,CAAC,EACF,IAAA,8BAAc,EAAC,IAAI,CAAC,CACpB;aACA,SAAS,EAAE,CAAC;IACf,CAAC;IAED,QAAQ;QACP,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;IACvB,CAAC;IAEO,cAAc;QACrB,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,SAAS;YAClC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,YAAY,CAAC;IACzC,CAAC;IAED,SAAS;QACR,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,GAAG,GAAG;YACV,IAAI,EAAE,YAAY,CAAC,KAAK;YACxB,IAAI,EAAE,EAAE;SACR,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC1D,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QACvD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,YAAY,CAAC;QACpC,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,aAAa,CAAC;QACjC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAC3B,CAAC;IAED,UAAU;QACT,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,GAAG,GAAG;YACV,IAAI,EAAE,YAAY,CAAC,IAAI;YACvB,IAAI,EAAE,EAAE;SACR,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAC3D,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAC3B,CAAC;IAED,YAAY,CAAC,CAAC;QACb,IAAI,CAAC,EAAE;YACN,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACvB;aAAM;YACN,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACtB;IACF,CAAC;IAED,IAAW,WAAW;QACrB,OAAO,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC;IACxC,CAAC;CACD,CAAA;AAhKqB;IAApB,IAAA,gBAAS,EAAC,QAAQ,CAAC;sCAAS,iBAAU;wDAAC;AAChB;IAAvB,IAAA,gBAAS,EAAC,WAAW,CAAC;;8DAAc;mCAFzB,wBAAwB;IAPpC,IAAA,4BAAY,EAAC,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC;IACvC,IAAA,gBAAS,EAAC;QACV,QAAQ,EAAE,sBAAsB;QAChC,WAAW,EAAE,mCAAmC;QAChD,SAAS,EAAE,CAAC,mCAAmC,CAAC;QAChD,eAAe,EAAE,8BAAuB,CAAC,MAAM;KAC/C,CAAC;IA2BC,mBAAA,IAAA,aAAM,EAAC,qBAAS,CAAC,CAAA;6CALO,0BAAe;QAC1B,wBAAiB;QACG,mDAAuB;QAC9B,uBAAgB;QAC1B,aAAM,UAGS,+BAAY;GA5BjC,wBAAwB,CAiKpC","sourcesContent":["import {\r\n\tAfterViewInit,\r\n\tChangeDetectionStrategy,\r\n\tChangeDetectorRef,\r\n\tComponent,\r\n\tElementRef,\r\n\tInject,\r\n\tNgZone,\r\n\tOnInit,\r\n\tViewChild,\r\n} from '@angular/core';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { LanguagesEnum } from '@gauzy/contracts';\r\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { from, tap } from 'rxjs';\r\nimport { GAUZY_ENV } from '../constants';\r\nimport { ElectronService } from '../electron/services';\r\nimport { LanguageSelectorService } from '../language/language-selector.service';\r\n\r\nexport enum ServerStatus {\r\n\tSTART = 'BUTTONS.START',\r\n\tSTOP = 'BUTTONS.STOP'\r\n}\r\n\r\n@UntilDestroy({ checkProperties: true })\r\n@Component({\r\n\tselector: 'ngx-server-dashboard',\r\n\ttemplateUrl: './server-dashboard.component.html',\r\n\tstyleUrls: ['./server-dashboard.component.scss'],\r\n\tchangeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ServerDashboardComponent implements OnInit, AfterViewInit {\r\n\t@ViewChild('logBox') logBox: ElementRef;\r\n\t@ViewChild('logServer') logAccordion;\r\n\tactive_index: any;\r\n\tgauzyIcon: SafeResourceUrl = './assets/images/logos/logo_Gauzy.svg';\r\n\trunning = false;\r\n\tloading = false;\r\n\trestart = false;\r\n\tbtn: any = {\r\n\t\tname: ServerStatus.START,\r\n\t\ticon: 'arrow-right-outline',\r\n\t};\r\n\tlogContents: any = [];\r\n\tisExpandWindow = false;\r\n\tlogIsOpen = false;\r\n\tstyles = {\r\n\t\tbtnStart: 'button-small',\r\n\t\ticon: 'margin-icon-small',\r\n\t};\r\n\r\n\tconstructor(\r\n\t\tprivate electronService: ElectronService,\r\n\t\tprivate _cdr: ChangeDetectorRef,\r\n\t\tprivate _languageSelectorService: LanguageSelectorService,\r\n\t\tprivate _translateService: TranslateService,\r\n\t\tprivate _ngZone: NgZone,\r\n\t\t@Inject(GAUZY_ENV)\r\n\t\tprivate readonly _environment: any,\r\n\t\tprivate readonly _domSanitizer: DomSanitizer\r\n\t) {\r\n\t\tthis.electronService.ipcRenderer.on('running_state', (event, arg) => {\r\n\t\t\tthis.loading = false;\r\n\t\t\tthis.btn = {\r\n\t\t\t\tname: arg ? ServerStatus.STOP : ServerStatus.START,\r\n\t\t\t\ticon: arg ? 'stop-circle-outline' : 'arrow-right-outline',\r\n\t\t\t};\r\n\t\t\tthis.running = arg;\r\n\t\t\tevent.sender.send('running_state', arg);\r\n\t\t\tif(this.running) {\r\n\t\t\t\tthis.restart = false;\r\n\t\t\t}\r\n\t\t\tthis._cdr.detectChanges();\r\n\t\t});\r\n\r\n\t\tthis.electronService.ipcRenderer.on('log_state', (event, arg) => {\r\n\t\t\tif (this.logContents.length < 20) {\r\n\t\t\t\tthis.logContents.push(arg.msg);\r\n\t\t\t} else {\r\n\t\t\t\tthis.logContents.shift();\r\n\t\t\t\tthis.logContents.push(arg.msg);\r\n\t\t\t}\r\n\t\t\tthis._cdr.detectChanges();\r\n\t\t\tthis.scrollToBottom();\r\n\t\t\tconsole.log(arg);\r\n\t\t});\r\n\r\n\t\tthis.electronService.ipcRenderer.on('resp_msg', (event, arg) => {\r\n\t\t\tthis.restart = arg?.type === 'restart';\r\n\t\t\tevent.sender.send('resp_msg_server', arg);\r\n\t\t\tthis._cdr.detectChanges();\r\n\t\t});\r\n\r\n\t\tthis.electronService.ipcRenderer.on('loading_state', (event, arg) => {\r\n\t\t\tthis.loading = arg;\r\n\t\t\tevent.sender.send('loading_state');\r\n\t\t\tthis.electronService.ipcRenderer.send('expand_window');\r\n\t\t\tthis.isExpandWindow = true;\r\n\t\t\tthis.styles.btnStart = 'button-big';\r\n\t\t\tthis.styles.icon = 'margin-icon';\r\n\t\t\tthis.logIsOpen = true;\r\n\t\t\tthis._cdr.detectChanges();\r\n\t\t});\r\n\r\n\t\tthis.gauzyIcon = this._domSanitizer.bypassSecurityTrustResourceUrl(\r\n\t\t\tthis._environment.PLATFORM_LOGO\r\n\t\t);\r\n\t}\r\n\tngAfterViewInit(): void {\r\n\t\tthis.electronService.ipcRenderer.on(\r\n\t\t\t'dashboard_ready',\r\n\t\t\t(event, arg) => {\r\n\t\t\t\tthis._ngZone.run(() => {\r\n\t\t\t\t\tif (!!arg.setting?.autoStart ?? true) {\r\n\t\t\t\t\t\tthis.runServer();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t\tthis.electronService.ipcRenderer.on(\r\n\t\t\t'preferred_language_change',\r\n\t\t\t(event, language: LanguagesEnum) => {\r\n\t\t\t\tthis._ngZone.run(() => {\r\n\t\t\t\t\tthis._languageSelectorService.setLanguage(\r\n\t\t\t\t\t\tlanguage,\r\n\t\t\t\t\t\tthis._translateService\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._cdr.detectChanges();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t\tfrom(this.electronService.ipcRenderer.invoke('PREFERRED_LANGUAGE'))\r\n\t\t\t.pipe(\r\n\t\t\t\ttap((language) => {\r\n\t\t\t\t\tthis._languageSelectorService.setLanguage(\r\n\t\t\t\t\t\tlanguage,\r\n\t\t\t\t\t\tthis._translateService\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._cdr.detectChanges();\r\n\t\t\t\t}),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t\tthis.active_index = 0;\r\n\t}\r\n\r\n\tprivate scrollToBottom() {\r\n\t\tthis.logBox.nativeElement.scrollTop =\r\n\t\t\tthis.logBox.nativeElement.scrollHeight;\r\n\t}\r\n\r\n\trunServer() {\r\n\t\tthis.logContents = [];\r\n\t\tthis.loading = true;\r\n\t\tthis.btn = {\r\n\t\t\tname: ServerStatus.START,\r\n\t\t\ticon: '',\r\n\t\t};\r\n\t\tthis.logIsOpen = true;\r\n\t\tthis.electronService.ipcRenderer.send('run_gauzy_server');\r\n\t\tthis.electronService.ipcRenderer.send('expand_window');\r\n\t\tthis.isExpandWindow = true;\r\n\t\tthis.styles.btnStart = 'button-big';\r\n\t\tthis.styles.icon = 'margin-icon';\r\n\t\tthis._cdr.detectChanges();\r\n\t}\r\n\r\n\tstopServer() {\r\n\t\tthis.loading = true;\r\n\t\tthis.btn = {\r\n\t\t\tname: ServerStatus.STOP,\r\n\t\t\ticon: '',\r\n\t\t};\r\n\t\tthis.logIsOpen = true;\r\n\t\tthis.electronService.ipcRenderer.send('stop_gauzy_server');\r\n\t\tthis._cdr.detectChanges();\r\n\t}\r\n\r\n\tlogBoxChange(e) {\r\n\t\tif (e) {\r\n\t\t\tthis.logIsOpen = false;\r\n\t\t} else {\r\n\t\t\tthis.logIsOpen = true;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get isServerApi(): boolean {\r\n\t\treturn this._environment.IS_SERVER_API;\r\n\t}\r\n}\r\n"]}