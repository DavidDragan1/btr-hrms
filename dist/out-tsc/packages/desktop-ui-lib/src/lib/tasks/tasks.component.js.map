{"version":3,"file":"tasks.component.js","sourceRoot":"","sources":["../../../../../../../packages/desktop-ui-lib/src/lib/tasks/tasks.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, EventEmitter, Input, OnInit, Output, Inject } from '@angular/core';\r\nimport { FormControl, UntypedFormGroup, Validators } from '@angular/forms';\r\nimport { TimeTrackerService } from '../time-tracker/time-tracker.service';\r\nimport {\r\n\tIEmployee,\r\n\tIOrganizationContact,\r\n\tIOrganizationProject,\r\n\tIOrganizationTeam,\r\n\tITag,\r\n\tITagCreateInput,\r\n\tITaskPriority,\r\n\tITaskSize,\r\n\tITaskStatus,\r\n\tIUserOrganization,\r\n\tPermissionsEnum,\r\n\tTaskStatusEnum\r\n} from '@gauzy/contracts';\r\nimport { NbDialogRef, NbToastrService } from '@nebular/theme';\r\nimport * as moment from 'moment';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { CkEditorConfig, ColorAdapter } from '../utils';\r\nimport { Store, TagService } from '../services';\r\nimport { GAUZY_ENV } from '../constants';\r\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\r\nimport { tap, from, Observable, map } from 'rxjs';\r\n\r\n@UntilDestroy({ checkProperties: true })\r\n@Component({\r\n\tselector: 'ngx-tasks',\r\n\ttemplateUrl: './tasks.component.html',\r\n\tstyleUrls: ['./tasks.component.scss']\r\n})\r\nexport class TasksComponent implements OnInit {\r\n\t@Input() userData: IUserOrganization;\r\n\t@Input() employee: IEmployee;\r\n\t@Input() hasProjectPermission: boolean;\r\n\t@Input() selected: {\r\n\t\tprojectId: IOrganizationProject['id'];\r\n\t\tteamId: IOrganizationTeam['id'];\r\n\t\tcontactId: IOrganizationContact['id'];\r\n\t};\r\n\t@Output() isAddTask: EventEmitter<boolean> = new EventEmitter();\r\n\t@Output() newTaskCallback: EventEmitter<{\r\n\t\tisSuccess: boolean;\r\n\t\tmessage: string;\r\n\t}> = new EventEmitter();\r\n\tpublic isSaving: boolean;\r\n\tpublic editorConfig = CkEditorConfig.minimal();\r\n\tpublic hasAddTagPermission$: Observable<boolean>;\r\n\r\n\tform: UntypedFormGroup;\r\n\tprojects: IOrganizationProject[] = [];\r\n\temployees: IEmployee[] = [];\r\n\ttags: ITag[] = [];\r\n\ttaskSizes: ITaskSize[] = [];\r\n\ttaskStatuses: ITaskStatus[] = [];\r\n\ttaskPriorities: ITaskPriority[] = [];\r\n\tcontacts: IOrganizationContact[] = [];\r\n\tteams: IOrganizationTeam[] = [];\r\n\tstatuses = [\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.OPEN,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.OPEN)\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.IN_PROGRESS,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.IN_PROGRESS)\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.READY_FOR_REVIEW,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.READY_FOR_REVIEW)\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.IN_REVIEW,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.IN_REVIEW)\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.BLOCKED,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.BLOCKED)\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: TaskStatusEnum.COMPLETED,\r\n\t\t\tname: this._formatStatus(TaskStatusEnum.COMPLETED)\r\n\t\t}\r\n\t];\r\n\tpublic isLoading = false;\r\n\r\n\tconstructor(\r\n\t\tprivate timeTrackerService: TimeTrackerService,\r\n\t\tprivate toastrService: NbToastrService,\r\n\t\tprivate translate: TranslateService,\r\n\t\t@Inject(GAUZY_ENV)\r\n\t\tprivate readonly _environment: any,\r\n\t\tprivate store: Store,\r\n\t\tprivate _dialogRef: NbDialogRef<TasksComponent>,\r\n\t\tprivate _tagService: TagService\r\n\t) {\r\n\t\tthis.isSaving = false;\r\n\t}\r\n\r\n\tprivate async _projects(user: IUserOrganization): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.projects = await this.timeTrackerService.getProjects({\r\n\t\t\t\torganizationContactId: this.selected.contactId,\r\n\t\t\t\torganizationTeamId: this.selected.teamId,\r\n\t\t\t\t...user\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', \"can't get employee project::\" + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _tags(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.tags = await this._tagService.getTags();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get tags::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _employees(user: IUserOrganization): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst employee = await this.timeTrackerService.getEmployees(user);\r\n\t\t\tthis.employees = [employee];\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get employees::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _clients(user: IUserOrganization): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.contacts = await this.timeTrackerService.getClient(user);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get contacts::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _teams(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.teams = await this.timeTrackerService.getTeams();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get teams::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _sizes(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.taskSizes = await this.timeTrackerService.taskSizes();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get sizes::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async _priorities(): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis.taskPriorities = await this.timeTrackerService.taskPriorities();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[error]', 'while get priorities::' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _formatStatus(name: string): string {\r\n\t\treturn name\r\n\t\t\t.split('-')\r\n\t\t\t.join(' ')\r\n\t\t\t.replace(/(^\\w{1})|(\\s+\\w{1})/g, (letter) => letter.toUpperCase());\r\n\t}\r\n\r\n\tngOnInit() {\r\n\t\tthis.editorConfig.editorplaceholder = this.translate.instant('FORM.PLACEHOLDERS.DESCRIPTION');\r\n\t\tthis.taskStatuses = this.store.statuses;\r\n\t\tfrom(\r\n\t\t\tPromise.allSettled([\r\n\t\t\t\tthis._projects(this.userData),\r\n\t\t\t\tthis._tags(),\r\n\t\t\t\tthis._employees(this.userData),\r\n\t\t\t\tthis._clients(this.userData),\r\n\t\t\t\tthis._teams(),\r\n\t\t\t\tthis._sizes(),\r\n\t\t\t\tthis._priorities()\r\n\t\t\t])\r\n\t\t)\r\n\t\t\t.pipe(\r\n\t\t\t\ttap(() => this.form.patchValue({ taskStatus: this.taskStatuses[0] })),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\r\n\t\tthis.form = new UntypedFormGroup({\r\n\t\t\tdescription: new FormControl(null),\r\n\t\t\tdueDate: new FormControl(moment().add(1, 'day').utc().toDate()),\r\n\t\t\testimate: new FormControl(null),\r\n\t\t\testimateDays: new FormControl(null, [Validators.min(0)]),\r\n\t\t\testimateHours: new FormControl(null, [Validators.min(0), Validators.max(23)]),\r\n\t\t\testimateMinutes: new FormControl(null, [Validators.min(0), Validators.max(59)]),\r\n\t\t\tmembers: new FormControl([]),\r\n\t\t\torganizationId: new FormControl(this.userData.organizationId),\r\n\t\t\tproject: new FormControl(null),\r\n\t\t\tprojectId: new FormControl(this.selected.projectId),\r\n\t\t\tstatus: new FormControl(TaskStatusEnum.OPEN),\r\n\t\t\tpriority: new FormControl(null),\r\n\t\t\tsize: new FormControl(null),\r\n\t\t\ttags: new FormControl([]),\r\n\t\t\tteams: new FormControl([]),\r\n\t\t\ttenantId: new FormControl(this.userData.tenantId),\r\n\t\t\ttitle: new FormControl(null, Validators.required),\r\n\t\t\ttaskStatus: new FormControl(null),\r\n\t\t\ttaskPriority: new FormControl(null),\r\n\t\t\ttaskSize: new FormControl(null),\r\n\t\t\torganizationContactId: new FormControl(this.selected.contactId),\r\n\t\t\torganizationTeamId: new FormControl(this.selected.teamId)\r\n\t\t});\r\n\t\tthis.hasAddTagPermission$ = this.store.userRolePermissions$.pipe(\r\n\t\t\tmap(() => this.store.hasPermissions(PermissionsEnum.ALL_ORG_EDIT, PermissionsEnum.ORG_TAGS_ADD))\r\n\t\t);\r\n\t}\r\n\r\n\tpublic close(res?: any): void {\r\n\t\tthis._dialogRef.close(res);\r\n\t}\r\n\r\n\tpublic async save(): Promise<void> {\r\n\t\tif (this.form.invalid) return;\r\n\t\tthis.isSaving = true;\r\n\t\tconst {\r\n\t\t\testimateDays,\r\n\t\t\testimateHours,\r\n\t\t\testimateMinutes,\r\n\t\t\tprojectId,\r\n\t\t\ttaskStatus,\r\n\t\t\ttaskPriority,\r\n\t\t\ttaskSize,\r\n\t\t\torganizationTeamId\r\n\t\t} = this.form.value;\r\n\t\tconst days = estimateDays ? estimateDays * 24 * 3600 : 0;\r\n\t\tconst hours = estimateHours ? estimateHours * 3600 : 1;\r\n\t\tconst minutes = estimateMinutes ? estimateMinutes * 60 : 0;\r\n\t\tconst status = taskStatus?.name;\r\n\t\tconst size = taskSize?.name;\r\n\t\tconst priority = taskPriority?.name;\r\n\t\tconst teams = this.teams.filter(({ id }) => id === organizationTeamId);\r\n\t\tconst [project] = this.projects.filter(({ id }) => id === projectId);\r\n\r\n\t\ttry {\r\n\t\t\tthis.form.patchValue({\r\n\t\t\t\tmembers: [...this.employees],\r\n\t\t\t\testimate: days + hours + minutes,\r\n\t\t\t\tproject,\r\n\t\t\t\tstatus,\r\n\t\t\t\tsize,\r\n\t\t\t\tpriority,\r\n\t\t\t\tteams\r\n\t\t\t});\r\n\r\n\t\t\tawait this.timeTrackerService.saveNewTask(this.userData, this.form.value);\r\n\t\t\tthis.close({\r\n\t\t\t\tisSuccess: true,\r\n\t\t\t\tmessage: this.translate.instant('TOASTR.MESSAGE.CREATED')\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t\tthis.close({\r\n\t\t\t\tisSuccess: false,\r\n\t\t\t\tmessage: error.message\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.isSaving = false;\r\n\t}\r\n\r\n\tpublic addProject = async (name: string) => {\r\n\t\ttry {\r\n\t\t\tconst data = this.userData as any;\r\n\t\t\tconst { tenantId, organizationContactId } = data;\r\n\t\t\tconst { organizationId } = data;\r\n\r\n\t\t\tconst request = {\r\n\t\t\t\tname,\r\n\t\t\t\torganizationId,\r\n\t\t\t\ttenantId,\r\n\t\t\t\t...(organizationContactId ? { contactId: organizationContactId } : {})\r\n\t\t\t};\r\n\r\n\t\t\trequest['members'] = [...this.employees];\r\n\r\n\t\t\tconst project = await this.timeTrackerService.createNewProject(request, data);\r\n\r\n\t\t\tthis.projects = this.projects.concat([project]);\r\n\t\t\tthis.toastrService.success(\r\n\t\t\t\tthis.translate.instant('TIMER_TRACKER.TOASTR.PROJECT_ADDED'),\r\n\t\t\t\tthis._environment.DESCRIPTION\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tthis.toastrService.danger(error);\r\n\t\t}\r\n\t};\r\n\r\n\tpublic background(bgColor: string) {\r\n\t\treturn ColorAdapter.background(bgColor);\r\n\t}\r\n\r\n\tpublic backgroundContrast(bgColor: string) {\r\n\t\treturn ColorAdapter.contrast(bgColor);\r\n\t}\r\n\r\n\t/**\r\n\t * Create new tag\r\n\t *\r\n\t * @param name\r\n\t * @returns\r\n\t */\r\n\tpublic createTag = async (name: ITagCreateInput['name']): Promise<void> => {\r\n\t\tif (!name) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.isLoading = true;\r\n\r\n\t\tconst { organizationId, tenantId } = this.store;\r\n\r\n\t\ttry {\r\n\t\t\tthis.tags = await this._tagService.create({\r\n\t\t\t\tname,\r\n\t\t\t\tcolor: ColorAdapter.randomColor(),\r\n\t\t\t\tdescription: '',\r\n\t\t\t\ttenantId,\r\n\t\t\t\torganizationId\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('Error while creating tags', error);\r\n\t\t} finally {\r\n\t\t\tthis.isLoading = false;\r\n\t\t}\r\n\t};\r\n}\r\n"]}