{"version":3,"file":"language-selector.component.js","sourceRoot":"","sources":["../../../../../../../packages/desktop-ui-lib/src/lib/language/language-selector.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { AfterViewInit, Component, Input, NgZone, OnInit } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { ILanguage, IUser, IUserUpdateInput, LanguagesEnum } from '@gauzy/contracts';\r\nimport { distinctUntilChange } from '@gauzy/ui-sdk/common';\r\nimport { UserOrganizationService } from '../time-tracker/organization-selector/user-organization.service';\r\nimport { LanguageService } from './language.service';\r\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\r\nimport { tap, filter, from, BehaviorSubject, Observable, concatMap, Subject } from 'rxjs';\r\nimport { Store } from '../services';\r\nimport { LanguageSelectorService } from './language-selector.service';\r\nimport { ElectronService } from '../electron/services';\r\n\r\n@UntilDestroy({ checkProperties: true })\r\n@Component({\r\n\tselector: 'gauzy-language-selector',\r\n\ttemplateUrl: './language-selector.component.html',\r\n\tstyleUrls: ['./language-selector.component.scss']\r\n})\r\nexport class LanguageSelectorComponent implements OnInit, AfterViewInit {\r\n\tprivate _user: IUser;\r\n\tprivate _languages$: BehaviorSubject<ILanguage[]>;\r\n\tprivate _preferredLanguage: LanguagesEnum;\r\n\tprivate _isSetup: boolean;\r\n\tprivate _update$: Subject<LanguagesEnum>;\r\n\r\n\tconstructor(\r\n\t\tprivate readonly _store: Store,\r\n\t\tprivate readonly _userService: UserOrganizationService,\r\n\t\tprivate readonly _translate: TranslateService,\r\n\t\tprivate readonly _languageService: LanguageService,\r\n\t\tprivate readonly _languageSelectorService: LanguageSelectorService,\r\n\t\tprivate readonly _electronService: ElectronService,\r\n\t\tprivate readonly _ngZone: NgZone\r\n\t) {\r\n\t\tthis._languages$ = new BehaviorSubject([]);\r\n\t\tthis._preferredLanguage = LanguagesEnum.ENGLISH;\r\n\t\tthis._update$ = new Subject();\r\n\t\tthis._isSetup = false;\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t\tthis._store.systemLanguages$\r\n\t\t\t.pipe(\r\n\t\t\t\tfilter((languages: ILanguage[]) => !!languages),\r\n\t\t\t\ttap((languages: ILanguage[]) => this.systemLanguages(languages)),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\t\tthis._store.user$\r\n\t\t\t.pipe(\r\n\t\t\t\tfilter((user: IUser) => !!user),\r\n\t\t\t\ttap((user: IUser) => (this._user = user)),\r\n\t\t\t\ttap(({ preferredLanguage }: IUser) => {\r\n\t\t\t\t\tif (!this._store.preferredLanguage) {\r\n\t\t\t\t\t\tthis._store.preferredLanguage = preferredLanguage || LanguagesEnum.ENGLISH;\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\t\tthis._update$\r\n\t\t\t.pipe(\r\n\t\t\t\tfilter((preferredLanguage: LanguagesEnum) => !!preferredLanguage),\r\n\t\t\t\tdistinctUntilChange(),\r\n\t\t\t\ttap((preferredLanguage: LanguagesEnum) => (this._preferredLanguage = preferredLanguage)),\r\n\t\t\t\ttap(() => this.setLanguage()),\r\n\t\t\t\ttap((preferredLanguage: LanguagesEnum) =>\r\n\t\t\t\t\tthis._electronService.ipcRenderer.send('preferred_language_change', preferredLanguage)\r\n\t\t\t\t),\r\n\t\t\t\tfilter(() => !this.isSetup || !this._store.isOffline),\r\n\t\t\t\ttap((preferredLanguage: LanguagesEnum) => (this._store.preferredLanguage = preferredLanguage)),\r\n\t\t\t\tconcatMap((preferredLanguage: LanguagesEnum) =>\r\n\t\t\t\t\tthis.changePreferredLanguage({\r\n\t\t\t\t\t\tpreferredLanguage\r\n\t\t\t\t\t})\r\n\t\t\t\t),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\t}\r\n\r\n\tngAfterViewInit() {\r\n\t\tconst systemLanguages = this._store.systemLanguages;\r\n\t\tif (!systemLanguages) {\r\n\t\t\tfrom(this._loadLanguages()).subscribe();\r\n\t\t}\r\n\t\tthis._electronService.ipcRenderer.on('preferred_language_change', (event, language: LanguagesEnum) => {\r\n\t\t\tthis._ngZone.run(async () => {\r\n\t\t\t\tthis.updatePreferredLanguage = language;\r\n\t\t\t});\r\n\t\t});\r\n\t\tfrom(this._electronService.ipcRenderer.invoke('PREFERRED_LANGUAGE'))\r\n\t\t\t.pipe(\r\n\t\t\t\ttap((language: LanguagesEnum) => {\r\n\t\t\t\t\tthis.updatePreferredLanguage = language;\r\n\t\t\t\t}),\r\n\t\t\t\tuntilDestroyed(this)\r\n\t\t\t)\r\n\t\t\t.subscribe();\r\n\t}\r\n\r\n\tprivate async _loadLanguages() {\r\n\t\tconst { items = [] } =\r\n\t\t\tthis.isSetup || this._store.isOffline ? { items: [] } : await this._languageService.system();\r\n\t\tthis._store.systemLanguages = items.filter((item: ILanguage) => item.is_system) || [];\r\n\t}\r\n\r\n\tpublic systemLanguages(systemLanguages: ILanguage[]) {\r\n\t\tif (systemLanguages && systemLanguages.length > 0) {\r\n\t\t\tthis._languages$.next(\r\n\t\t\t\tsystemLanguages\r\n\t\t\t\t\t.filter((item) => !!item.is_system)\r\n\t\t\t\t\t.map((item) => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue: item.code,\r\n\t\t\t\t\t\t\tname: 'SETTINGS_MENU.' + item.name.toUpperCase()\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tconst languages = [];\r\n\t\t\tfor (const [name, code] of Object.entries(LanguagesEnum)) {\r\n\t\t\t\tlanguages.push({\r\n\t\t\t\t\tcode,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tis_system: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis._store.systemLanguages = languages;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async switchLanguage(): Promise<void> {\r\n\t\tthis.updatePreferredLanguage = this._preferredLanguage;\r\n\t}\r\n\r\n\tpublic setLanguage(): void {\r\n\t\tthis._languageSelectorService.setLanguage(this.preferredLanguage, this._translate);\r\n\t}\r\n\r\n\tprivate async changePreferredLanguage(payload: IUserUpdateInput) {\r\n\t\tif (!this._user || !this._user.tenantId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tawait this._userService.updatePreferredLanguage(payload);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(`Failed to update user preferred language`);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get languages$(): Observable<ILanguage[]> {\r\n\t\treturn this._languages$.asObservable();\r\n\t}\r\n\r\n\tpublic get preferredLanguage(): LanguagesEnum {\r\n\t\treturn this._preferredLanguage;\r\n\t}\r\n\r\n\tpublic set preferredLanguage(value: LanguagesEnum) {\r\n\t\tthis._preferredLanguage = value;\r\n\t}\r\n\r\n\tpublic set updatePreferredLanguage(language: LanguagesEnum) {\r\n\t\tif (language) {\r\n\t\t\tthis._update$.next(language);\r\n\t\t}\r\n\t}\r\n\r\n\t@Input('setup')\r\n\tpublic set isSetup(value: boolean) {\r\n\t\tthis._isSetup = value;\r\n\t}\r\n\r\n\tpublic get isSetup(): boolean {\r\n\t\treturn this._isSetup;\r\n\t}\r\n}\r\n"]}